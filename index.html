<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgroBet - Apostas Esportivas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Montserrat:wght@400;700&display=swap');
        body { font-family: 'Montserrat', sans-serif; background-color: #f8f8f8; }
        .title-font { font-family: 'Bebas Neue', cursive; }
        .bet-card, .bet-option, .confirm-btn, .modal { transition: all 0.3s ease; }
        .bet-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15); }
        .bet-option.selected, .bet-value.selected { background-color: #1b5e20; color: white; border-color: #1b5e20; }
        .confirm-btn { background: linear-gradient(135deg, #2e7d32 0%, #1b5e20 100%); }
        .confirm-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(46, 125, 50, 0.4); }
    </style>
</head>
<body class="bg-gray-100">

    <!-- Header -->
    <header class="bg-green-800 text-white py-4 shadow-md">
        <div class="container mx-auto px-4 flex justify-between items-center">
            <div>
                <h1 class="title-font text-4xl">AGROBET</h1>
                <p class="text-sm">Apostas Esportivas</p>
            </div>
            <div class="flex items-center space-x-4">
                <div id="user-info" class="text-right hidden">
                    <p class="font-bold text-lg">Olá, <span id="user-name-display"></span>!</p>
                </div>
                <button id="my-bets-btn" class="bg-white text-green-800 px-4 py-2 rounded-full font-bold flex items-center hover:bg-gray-200 transition">
                    <i class="fas fa-receipt mr-2"></i>Minhas Apostas
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <h2 class="title-font text-3xl md:text-4xl text-green-800 mb-8 text-center">JOGOS DISPONÍVEIS</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8" id="games-container">
            <!-- Os jogos serão inseridos dinamicamente aqui -->
        </div>
    </main>

    <!-- User Info Modal -->
    <div id="user-modal" class="modal fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-sm w-full mx-4 transform transition-all" style="opacity: 0; transform: scale(0.95);">
            <h3 class="title-font text-2xl text-center mb-4 text-green-800">Identificação do Apostador</h3>
            <p class="text-center text-gray-600 mb-6">Por favor, informe seu nome e chave PIX para o registro das apostas.</p>
            <div class="space-y-4">
                <input type="text" id="user-name-input" placeholder="Seu Nome Completo" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
                <input type="text" id="user-pix-input" placeholder="Sua Chave PIX" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-green-500">
            </div>
            <button id="save-user-info" class="w-full mt-6 py-3 confirm-btn text-white font-bold rounded-md">Salvar e Continuar</button>
        </div>
    </div>
    
    <!-- My Bets Modal -->
    <div id="my-bets-modal" class="modal fixed hidden inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50">
         <div class="bg-white rounded-lg p-6 max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto">
             <div class="flex justify-between items-center mb-4">
                 <h3 class="title-font text-2xl text-green-800">Minhas Apostas Registradas</h3>
                 <button id="close-my-bets" class="text-gray-500 hover:text-gray-800">&times;</button>
             </div>
             <div id="my-bets-list" class="space-y-3">
                 <!-- Lista de apostas do usuário -->
             </div>
         </div>
    </div>

     <!-- Loading Modal -->
    <div id="loading-modal" class="modal fixed hidden inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 text-center">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-green-800 mx-auto mb-4"></div>
            <p class="text-lg font-semibold">A processar pagamento...</p>
        </div>
    </div>


    <script>
        // --- CONFIGURAÇÃO DOS JOGOS ---
        const gamesConfig = {
            1: { home: { name: "ROUNDUP", logo: "https://i.postimg.cc/HsK6qHzZ/roundd.png" }, away: { name: "BULDOG", logo: "https://i.postimg.cc/GttjfSyn/roundd-1.png" }, date: "15/10/2025 - 20:00", competition: "CAMPEONATO FUTSAL" },
            2: { home: { name: "CAM", logo: "https://logodownload.org/wp-content/uploads/2016/10/atletico-mineiro-logo-escudo.png" }, away: { name: "COR", logo: "https://logodownload.org/wp-content/uploads/2016/11/Corinthians-logo-escudo-1.png" }, date: "18/10/2025 - 21:30", competition: "CAMPEONATO FUTSAL" }
        };

        // --- VARIÁVEIS GLOBAIS ---
        let currentUser = null;

        // --- ELEMENTOS DO DOM ---
        const gamesContainer = document.getElementById('games-container');
        const userModal = document.getElementById('user-modal');
        const myBetsModal = document.getElementById('my-bets-modal');
        const loadingModal = document.getElementById('loading-modal');

        // --- FUNÇÕES PRINCIPAIS ---

        function renderGames() {
            let gamesHTML = '';
            for (const gameId in gamesConfig) {
                const game = gamesConfig[gameId];
                gamesHTML += `
                <div class="bet-card bg-white rounded-lg shadow-md border border-gray-200 overflow-hidden" data-game-id="${gameId}">
                    <div class="bg-green-800 text-white py-2 px-4 flex justify-between items-center">
                        <h3 class="title-font text-xl">${game.competition}</h3>
                        <div class="text-sm bg-white text-green-800 font-bold px-3 py-1 rounded-full">${game.date}</div>
                    </div>
                    <div class="p-6">
                        <div class="flex justify-around items-center mb-6">
                            <div class="text-center w-1/3"><img src="${game.home.logo}" class="h-16 mx-auto mb-2"><span class="font-bold">${game.home.name}</span></div>
                            <div class="text-2xl font-bold text-gray-400">VS</div>
                            <div class="text-center w-1/3"><img src="${game.away.logo}" class="h-16 mx-auto mb-2"><span class="font-bold">${game.away.name}</span></div>
                        </div>
                        <div class="mb-4">
                            <h4 class="font-bold mb-2 text-center text-gray-700">PALPITE:</h4>
                            <div class="grid grid-cols-3 gap-2 bet-options">
                                <button class="bet-option py-2 border rounded-md" data-option="home">${game.home.name}</button>
                                <button class="bet-option py-2 border rounded-md" data-option="empate">EMPATE</button>
                                <button class="bet-option py-2 border rounded-md" data-option="away">${game.away.name}</button>
                            </div>
                        </div>
                        <div class="mb-6">
                            <h4 class="font-bold mb-2 text-center text-gray-700">VALOR:</h4>
                            <div class="grid grid-cols-4 gap-2 bet-values">
                                <button class="bet-value py-2 border rounded-md" data-value="5">R$ 5</button>
                                <button class="bet-value py-2 border rounded-md" data-value="10">R$ 10</button>
                                <button class="bet-value py-2 border rounded-md" data-value="25">R$ 25</button>
                                <button class="bet-value py-2 border rounded-md" data-value="50">R$ 50</button>
                            </div>
                        </div>
                        <button class="confirm-btn w-full py-3 rounded-md text-white font-bold text-lg" disabled>APOSTAR</button>
                    </div>
                </div>`;
            }
            gamesContainer.innerHTML = gamesHTML;
            addGameEventListeners();
        }

        function addGameEventListeners() {
            document.querySelectorAll('.bet-card').forEach(card => {
                const gameId = card.dataset.gameId;
                const betOptions = card.querySelector('.bet-options');
                const betValues = card.querySelector('.bet-values');
                const confirmBtn = card.querySelector('.confirm-btn');

                let selectedOption = null;
                let selectedValue = null;

                betOptions.addEventListener('click', e => {
                    if (e.target.tagName === 'BUTTON') {
                        betOptions.querySelectorAll('button').forEach(btn => btn.classList.remove('selected'));
                        e.target.classList.add('selected');
                        selectedOption = e.target.dataset.option;
                        checkSelections();
                    }
                });

                betValues.addEventListener('click', e => {
                    if (e.target.tagName === 'BUTTON') {
                        betValues.querySelectorAll('button').forEach(btn => btn.classList.remove('selected'));
                        e.target.classList.add('selected');
                        selectedValue = e.target.dataset.value;
                        checkSelections();
                    }
                });

                function checkSelections() {
                    confirmBtn.disabled = !(selectedOption && selectedValue);
                }

                confirmBtn.addEventListener('click', () => handleBet(gameId, selectedOption, selectedValue, card));
            });
        }
        
        async function handleBet(gameId, option, value, cardElement) {
            loadingModal.classList.remove('hidden');
            const game = gamesConfig[gameId];
            let betText = option === 'empate' ? 'EMPATE' : game[option].name;

            const betData = {
                title: `Aposta no jogo: ${game.home.name} vs ${game.away.name}`,
                description: `Palpite: ${betText}`,
                unit_price: value,
                user: currentUser
            };
            
            try {
                // *** ESTA É A LINHA QUE FOI ALTERADA ***
                const response = await fetch('https://agrobets.onrender.com/criar-pagamento', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(betData)
                });

                if (!response.ok) {
                    throw new Error('A resposta do servidor não foi OK.');
                }

                const data = await response.json();
                
                saveBetLocally(betData);
                window.location.href = data.init_point;

            } catch (error) {
                loadingModal.classList.add('hidden');
                alert("Não foi possível iniciar o pagamento. Verifique a sua ligação à internet e tente novamente.");
                console.error("Erro ao criar pagamento:", error);
            }
        }

        // --- GESTÃO DO UTILIZADOR E APOSTAS LOCAIS ---
        
        function checkUserInfo() {
            const storedUser = localStorage.getItem('agrobetUser');
            if (storedUser) {
                currentUser = JSON.parse(storedUser);
                document.getElementById('user-name-display').textContent = currentUser.name.split(' ')[0];
                document.getElementById('user-info').classList.remove('hidden');
                userModal.style.display = 'none';
            } else {
                userModal.style.display = 'flex';
                setTimeout(() => {
                    userModal.querySelector('div').style.opacity = 1;
                    userModal.querySelector('div').style.transform = 'scale(1)';
                }, 50);
            }
        }

        function saveBetLocally(betData) {
            const myBets = JSON.parse(localStorage.getItem('myBets')) || [];
            myBets.push({
                ...betData,
                date: new Date().toISOString()
            });
            localStorage.setItem('myBets', JSON.stringify(myBets));
        }

        function displayMyBets() {
            const myBets = JSON.parse(localStorage.getItem('myBets')) || [];
            const listElement = document.getElementById('my-bets-list');
            if (myBets.length === 0) {
                listElement.innerHTML = '<p class="text-gray-500">Ainda não fez nenhuma aposta.</p>';
                return;
            }
            listElement.innerHTML = myBets.reverse().map(bet => `
                <div class="border rounded-md p-3 bg-gray-50">
                    <p class="font-bold">${bet.title}</p>
                    <p>${bet.description} - <span class="font-bold text-green-600">R$ ${bet.betValue}</span></p>
                    <p class="text-sm text-gray-500">${new Date(bet.date).toLocaleString('pt-BR')}</p>
                </div>
            `).join('');
        }

        // --- EVENT LISTENERS ---

        document.getElementById('save-user-info').addEventListener('click', () => {
            const name = document.getElementById('user-name-input').value.trim();
            const pix = document.getElementById('user-pix-input').value.trim();
            if (name && pix) {
                currentUser = { name, pix };
                localStorage.setItem('agrobetUser', JSON.stringify(currentUser));
                userModal.querySelector('div').style.opacity = 0;
                userModal.querySelector('div').style.transform = 'scale(0.95)';
                setTimeout(() => {
                    userModal.style.display = 'none';
                    checkUserInfo();
                }, 300);
            } else {
                alert('Por favor, preencha todos os campos.');
            }
        });

        document.getElementById('my-bets-btn').addEventListener('click', () => {
            displayMyBets();
            myBetsModal.classList.remove('hidden');
        });

        document.getElementById('close-my-bets').addEventListener('click', () => {
            myBetsModal.classList.add('hidden');
        });

        // --- INICIALIZAÇÃO ---
        document.addEventListener('DOMContentLoaded', () => {
            renderGames();
            checkUserInfo();
        });
    </script>
</body>
</html>

